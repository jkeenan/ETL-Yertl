<!DOCTYPE html>
<html>
    <head>
        <link href="/ETL-Yertl/theme/css/normalize.css" rel="stylesheet">
        <link href="/ETL-Yertl/theme/css/skeleton.css" rel="stylesheet">
        <link href="/ETL-Yertl/theme/css/statocles-default.css" rel="stylesheet">
        <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet">
        <title>Yertl</title>
        <meta content="Statocles 0.055" name="generator">
        
    </head>
    <body>
        <header>
            <nav class="navbar">
                <div class="container">
                    <a class="brand" href="/ETL-Yertl/">Yertl</a>
                    <ul>
                        <li>
                            <a href="/ETL-Yertl/blog">Blog</a>
                        </li>
                        <li>
                            <a href="/ETL-Yertl/pod">Docs</a>
                        </li>
                        <li>
                            <a href="http://github.com/preaction/ETL-Yertl">Code</a>
                        </li>
                        <li>
                            <a href="http://github.com/preaction/ETL-Yertl/issues">Bugs</a>
                        </li>
                        <li>
                            <a href="http://metacpan.org/pod/ETL::Yertl">CPAN</a>
                        </li>
                        <li>
                            <a href="https://chat.mibbit.com/?channel=%23yertl&amp;server=irc.perl.org">IRC</a>
                        </li>
                    </ul>
                    
                </div>
            </nav>
            
        </header>
        <div class="main container">
            <a class="button" href="/ETL-Yertl/pod/ETL/Yertl/Command/yto.html">
    Back to documentation
</a>
<pre>package ETL::Yertl::Command::yto;
# ABSTRACT: Write documents to a format like JSON or CSV

use ETL::Yertl;
use Module::Runtime qw( use_module compose_module_name is_module_spec );
use ETL::Yertl::Format::yaml;

sub main {
    my $class = shift;

    my %opt;
    if ( ref $_[-1] eq &#39;HASH&#39; ) {
        %opt = %{ pop @_ };
    }

    my ( $format, @files ) = @_;

    die &quot;Must give a format\n&quot; unless $format;
    my $formatter_class = eval { compose_module_name( &#39;ETL::Yertl::Format&#39;, $format ) };
    if ( $@ ) {
        die &quot;Unknown format &#39;$format&#39;\n&quot;;
    }

    eval {
        use_module( $formatter_class );
    };
    if ( $@ ) {
        if ( $@ =~ /^Can&#39;t locate \S+ in \@INC/ ) {
            die &quot;Unknown format &#39;$format&#39;\n&quot;;
        }
        die &quot;Could not load format &#39;$format&#39;: $@&quot;;
    }

    my $out_fmt = $formatter_class-&gt;new( %opt );

    push @files, &quot;-&quot; unless @files;
    for my $file ( @files ) {
        # We&#39;re doing a similar behavior to &lt;&gt;, but manually for easier testing.
        my $fh;
        if ( $file eq &#39;-&#39; ) {
            # Use the existing STDIN so tests can fake it
            $fh = \*STDIN;
        }
        else {
            unless ( open $fh, &#39;&lt;&#39;, $file ) {
                warn &quot;Could not open file &#39;$file&#39; for reading: $!\n&quot;;
                next;
            }
        }

        my $in_fmt = ETL::Yertl::Format::yaml-&gt;new( input =&gt; $fh );
        print $out_fmt-&gt;write( $in_fmt-&gt;read );
    }
}

1;
__END__

=head1 SYNOPSIS

    ### On a shell...
    $ yto [-v] &lt;format&gt; [&lt;file&gt;...]
    $ yto [-h|--help|--version]

    ### In Perl...
    use ETL::Yertl;
    yto( &#39;&lt;format&gt;&#39;, &#39;&lt;filename&gt;&#39;, { verbose =&gt; 1 } );

=head1 DESCRIPTION

=head1 ARGUMENTS

=head1 OPTIONS

</pre>

        </div>
        <footer>
            <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-61295159-4', 'auto');
  ga('send', 'pageview');

</script>

            <div class="container tagline">
                <a href="http://preaction.github.io/Statocles">Made with Statocles</a><br>
                <a href="http://www.perl.org">Powered by Perl</a>
            </div>
        </footer>
    </body>
</html>
